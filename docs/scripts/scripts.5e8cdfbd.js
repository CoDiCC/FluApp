"use strict";angular.module("fluApp",["ngAnimate","ngCookies","ngSanitize","ngTouch","ui.bootstrap","ngCsv","schemaForm"]),angular.module("fluApp").controller("FormularioCtrl",["$scope","registos","schema",function(a,b,c){a.model={},a.schema=c;var d=[{type:"fieldset",title:"Informações gerais",items:[{key:"hospital"},{key:"numprocessoclinico"},{key:"datadeadmissao"},{key:"dataalta"},{key:"sexo"},{key:"datanascimento"},{key:"obito"},{type:"fieldset",title:"Se óbito...",condition:"model.obito",items:[{key:"dataobito"},{key:"causademorte"}]}]},{type:"fieldset",title:"Apresentação Clínica",items:[{key:"tosse"},{key:"febre"},{key:"dispneia"},{key:"odinofagia"},{key:"outrosintoma"},{key:"datainiciosintomas"}]},{type:"fieldset",title:"Vacinação",items:[{key:"vacinado"},{key:"datavacinacao"}]},{type:"fieldset",title:"Complicações",items:[{key:"sdra"},{key:"bronquiolite"},{key:"encefalite"},{key:"miocardite"},{key:"pneumonia"},{key:"sepsis"}]},{type:"fieldset",title:"Antecedentes",items:[{key:"asma"},{key:"dpoc"},{key:"diabetes"},{key:"doencaoncologica"},{key:"doencacardiacacronica"},{key:"hiv"},{key:"doencarenalcronica"},{key:"doencahepaticacronica"},{key:"doencaneuromuscular"},{key:"doencaneurocognitiva"},{key:"obesidade"},{key:"obesidademorbida"},{key:"gravidez"}]},{type:"fieldset",title:"Tratamento",items:[{key:"oseltamivir"},{key:"zanamivir"}]},{type:"fieldset",title:"Procedimentos",items:[{key:"vni"},{key:"intubacao"},{key:"ecmo"},{key:"dialise"},{key:"zaragatoa"},{key:"lavadoalveolar"},{key:"biopsia"}]},{type:"fieldset",title:"Laboratório",items:[{key:"serotipagem"}]},{type:"fieldset",title:"Observações",items:[{key:"observacoes",type:"textarea"}]},{type:"fieldset",title:"Acções",htmlClass:"stretch-all",items:[{type:"submit",title:"Carregar"},{type:"button",title:"Reset",fieldHtmlClass:"btn-danger"}]}];a.form=d,a.onSubmit=function(c){if(a.$broadcast("schemaFormValidate"),console.log(c.$valid),c.$valid){var d=angular.copy(a.model);b.add(d),a.model={},c.$setPristine(),c.$setUntouched()}}}]),angular.module("fluApp").controller("RegistosCtrl",["$scope","registos",function(a,b){a.headers=b.getHeaders(!0),a.props=b.getProps(),a.registos=b.getAll(),a.getArray=function(){return JSON.parse(angular.toJson(b.getAll()))},a.getHeaders=function(){return b.getHeaders()},a.reset=function(){window.confirm("Deseja mesmo apagar todos os registos?")===!0&&(b.reset(),a.registos=b.getAll())},a.deleteRecord=function(){if(window.confirm("Deseja mesmo apagar o(s) registo(s) seleccionados?")===!0)for(var c=a.registos.length-1,d=c;d>=0;--d)a.registos[d].$$selected===!0&&b.remove(d);a.registos=b.getAll()}}]),angular.module("fluApp").factory("registos",["schema",function(a){var b=[],c=[];for(var d in a.properties)if(a.properties.hasOwnProperty(d)){var e;c.push(d),e=a.properties[d].hasOwnProperty("title")?a.properties[d].title:d,b.push(e)}var f=[{hospital:"CHO",datadeadmissao:"03-06-1985",numprocessoclinico:1234,sexo:"M",$$selected:!1},{hospital:"CHLN",datadeadmissao:"01-06-1923",numprocessoclinico:4567,sexo:"F",$$selected:!1},{hospital:"CHUCH",datadeadmissao:"01-08-1993",numprocessoclinico:4567,sexo:"I",$$selected:!1}],g=function(a){return a.hasOwnProperty("$$selected")||(a.$$selected=!1),a};return{getHeaders:function(){return b},getProps:function(){return c},get:function(a){return f[a]},set:function(a,b){f[a]=g(b)},add:function(a){f.push(g(a))},remove:function(a){f.splice(a,1)},getAll:function(){return f},reset:function(){f=[]}}}]),angular.module("fluApp").factory("schema",function(){return{$schema:"http://json-schema.org/draft-04/schema#",id:"http://example.com/example.json",type:"object",required:["hospital"],properties:{hospital:{id:"/properties/hospital",title:"Hospital",type:"string"},numprocessoclinico:{id:"/properties/numprocessoclinico",title:"N.º processo clínico",type:"integer"},datadeadmissao:{id:"/properties/datadeadmissao",title:"Data de Admissão na UCI",type:"string",format:"date"},dataalta:{id:"/properties/dataalta",title:"Data da Alta UCI",type:"string",format:"date"},sexo:{id:"/properties/sexo",title:"Sexo",type:"string","enum":["M","F","I"]},datanascimento:{id:"/properties/datanascimento",title:"Data de Nascimento",type:"string",format:"date"},obito:{id:"/properties/obito",title:"Óbito?",type:"boolean"},dataobito:{id:"/properties/dataobit",title:"Data do òbito",type:"string",format:"date"},causademorte:{id:"/properties/causademorte",title:"Causa de Morte",type:"string",format:"date"},tosse:{id:"/properties/tosse",title:"Tosse",type:"boolean"},febre:{id:"/properties/vebre",title:"Febre",type:"boolean"},dispneia:{id:"/properties/dispneia",title:"Dispneia",type:"boolean"},odinofagia:{id:"/properties/odinofagia",title:"Odinofagia",type:"boolean"},outrosintoma:{id:"/properties/outrosintoma",title:"Outro sintoma",type:"string"},datainiciosintomas:{id:"/properties/datainiciosintomas",title:"Data de Início de Sintomas",type:"string",format:"date"},vacinado:{id:"/properties/vacinado",title:"Vacinado",description:"O doente foi vacinado contra a gripe nesta época?",type:"boolean"},datavacinacao:{id:"/properties/datavacinacao",title:"Data de Vacinação",type:"string",format:"date"},sdra:{id:"/properties/sdra",title:"SDRA",description:"Síndrome de Desconforto Respiratório no Adulto",type:"boolean"},bronquiolite:{id:"/properties/bronquiolite",title:"Bronquiolite",type:"boolean"},encefalite:{id:"/properties/encefalite",title:"Encefalite",type:"boolean"},miocardite:{id:"/properties/miocardite",title:"Miocardite",type:"boolean"},pneumonia:{id:"/properties/pneumonia",title:"Pneumonia",type:"boolean"},sepsis:{id:"/properties/sepsis",title:"Sepsis",type:"boolean"},asma:{id:"/properties/asma",title:"Asma",type:"boolean"},dpoc:{id:"/properties/dpoc",title:"DPOC",type:"boolean"},diabetes:{id:"/properties/diabetes",title:"Diabetes",type:"boolean"},doencaoncologica:{id:"/properties/doencaoncologica",title:"Doença Oncológica",type:"boolean"},doencacardiacacronica:{id:"/properties/doencacardiacacronica",title:"Doença Cardíaca Crónica",type:"boolean"},hiv:{id:"/properties/hiv",title:"HIV",type:"boolean"},doencarenalcronica:{id:"/properties/doencarenalcronica",title:"Doença Renal Crónica",type:"boolean"},doencahepaticacronica:{id:"/properties/doencahepaticacronica",title:"Doença Hepática Crónica",type:"boolean"},doencaneuromuscular:{id:"/properties/doencaneuromuscular",title:"doencaneuromuscular",type:"boolean"},doencaneurocognitiva:{id:"/properties/doencaneurocognitiva",title:"Doença Neurocognitiva",type:"boolean"},obesidade:{id:"/properties/obesidade",title:"Obesidade",description:"IMC entre 30kg/m2 e 40kg/m2",type:"boolean"},obesidademorbida:{id:"/properties/obesidademorbida",title:"Obesidade Mórbida",description:"IMC > 40kg/m2",type:"boolean"},gravidez:{id:"/properties/gravidez",title:"Gravidez",description:"Está grávida?",type:"boolean"},oseltamivir:{id:"/properties/oseltamivir",title:"Oseltamivir",type:"boolean"},zanamivir:{id:"/properties/zanamivir",title:"Aanamivir",type:"boolean"},vni:{id:"/properties/vni",title:"Ventilação mecânica não invasiva",description:"CPAP ou BIPAP",type:"boolean"},intubacao:{id:"/properties/intubacao",title:"Ventilação mecânica invasiva",type:"boolean"},ecmo:{id:"/properties/ecmo",title:"ECMO",type:"boolean"},dialise:{id:"/properties/dialise",title:"Técnica de substituição renal",type:"boolean"},zaragatoa:{id:"/properties/zaragatoa",title:"Zaragatoa naso ou orofaríngea",type:"boolean"},lavadoalveolar:{id:"/properties/lavadoalveolar",title:"Aspirado endotraqueal ou lavado broncoalveolar",type:"boolean"},biopsia:{id:"/properties/lavadoalveolar",title:"Biópsia tecidular post-mortem",type:"boolean"},serotipagem:{id:"/properties/serotipagem",title:"Tipo e subtipo do vírus",type:"string","enum":["A","AH1","AH1N1","AH3","AH3N2","AH5","AH5N1","B","BVic","BYam","PanAH1","PanAH1N1","UNK","Outro"]},observacoes:{id:"/properties/observacoes",title:"Observações",type:"string"}}}}),angular.module("fluAppApp").run(["$templateCache",function(a){a.put("views/formulario.html",'<header> <h2>Formulário</h2> </header> <section> <form id="registoForm" name="registoForm" sf-schema="schema" data-sf-form="form" data-sf-model="model" ng-submit="onSubmit(registoForm)"></form> </section> '),a.put("views/instrucoes.html","<header> <h2>Instruções</h2> </header> <section> <p>Algumas instruções bla</p> </section>"),a.put("views/registos.html",'<header> <h2>Registos</h2> </header> <section id="registos" class="table-responsive"> <div class="panel panel-default"> <!-- Default panel contents --> <div class="panel-heading panel-button-top"> <div class="btn btn-success" ng-csv="getArray" data-csv-header="getHeaders()" data-csv-column-order="getHeaders()" data-quote-strings="true" data-filename="registo.csv"> <i class="fa fa-floppy-o" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Guardar como CSV </div> <div class="btn btn-danger" ng-click="reset()"><i class="fa fa-eraser" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Reset</div> <div class="btn btn-danger" ng-click="deleteRecord()"><i class="fa fa-minus-square" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;Apagar registo</div> </div> <div class="panel-table-wrapper"> <table class="table table-condensed table-hover table-overflow-x"> <thead class="thead-inverse"> <tr> <th></th> <th>#</th> <th ng-repeat="header in headers">{{::header}}</th> </tr> </thead> <tbody> <tr ng-repeat="item in registos track by $index" ng-class="{\'info\': r.$$selected}" ng-click="r.$$selected = !r.$$selected"> <th class="table-select-row"> <i class="fa" ng-class="{\'fa-square-o\': !r.$$selected, \'fa-check-square-o\': r.$$selected}" aria-hidden="true"></i> </th> <th>{{ $index }}</th> <td ng-repeat="prop in props">{{::item[prop]}}</td> </tr> </tbody> </table> </div> </div> </section>')}]);